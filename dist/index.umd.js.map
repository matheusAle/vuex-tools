{"version":3,"file":"index.umd.js","sources":["../src/createModule.ts","../src/createStore.ts"],"sourcesContent":["import type { ActionContext, Getter } from 'vuex';\nimport type {\n  ModuleBuilder,\n  Mutation,\n  ActionHandler,\n  ActionType,\n} from './types';\nimport Vue from 'vue';\nconst actionCreator = <P>(\n  moduleName: () => string | undefined,\n  type: string,\n) => (payload: P) => ({\n  type: moduleName() ? `${moduleName()}/${type}` : type,\n  payload,\n});\n\nfunction overrideActionContext<State, RootState, Payload>(\n  action: ActionHandler<State, RootState, Payload>,\n) {\n  return (\n    store: ActionContext<State, RootState>,\n    { payload }: ReturnType<ActionType<Payload>>,\n  ) =>\n    action(\n      {\n        ...store,\n        commit: (type) => store.commit(type, { root: true }),\n        dispatch: (type) => store.dispatch(type, { root: true }),\n      },\n      payload,\n    );\n}\n\n/**\n * Create a {@see ModuleBuilder} instance.\n *\n * ```ts\n * interface RootState {\n *   module_one: {\n *     list: string[]\n *   }\n * }\n * const module = createModule<RootState['module_one'], RootState>({ list: [] });\n *\n * @param initialState - initial module state\n * @typeParam State - Type of module state, usually an key in RootState.\n * @typeParam RootState - Type of root store state\n */\nexport function createModule<State, RootState = any>(\n  initialState: State,\n): ModuleBuilder<State, RootState> {\n  const mutations: Mutation<State, unknown>[] = [];\n  const actions: ActionHandler<State, RootState, unknown>[] = [];\n  const getters: Getter<State, RootState>[] = [];\n\n  let moduleName: string;\n  const getModuleName = () => moduleName;\n\n  return <ModuleBuilder<State, RootState>>{\n    mutation<Payload>(type: string, fn?: Mutation<State, Payload>) {\n      if (!fn) {\n        return this.mutation(`${type}`, (state, value) => {\n          Vue.set(state as any, `${type}`, value);\n        });\n      }\n      fn.toString = () => `${type}`;\n      (mutations as Mutation<State, Payload>[]).push(fn);\n      return actionCreator<Payload>(getModuleName, type);\n    },\n    action<Payload>(\n      type: string,\n      fn: ActionHandler<State, RootState, Payload>,\n    ) {\n      fn.toString = () => `${type}`;\n      (actions as ActionHandler<State, RootState, Payload>[]).push(fn);\n      return actionCreator<Payload>(getModuleName, type);\n    },\n    getter<Payload>(type: string, fn: Getter<State, RootState>) {\n      fn.toString = () => `${type}`;\n      getters.push(fn);\n      return (getter: any): Payload =>\n        getter[`${moduleName}/${type}`] || getter[type];\n    },\n    getModule(name = '') {\n      moduleName = name;\n      return {\n        name: moduleName,\n        namespaced: true,\n        state: initialState,\n        actions: actions.reduce((acc, action) => {\n          acc[action.toString()] = overrideActionContext(action);\n          return acc;\n        }, {}),\n        mutations: mutations.reduce((acc, mutation) => {\n          acc[mutation.toString()] = (store, { payload }) =>\n            mutation(store, payload);\n          return acc;\n        }, {}),\n        getters: getters.reduce((acc, getter) => {\n          acc[getter.toString()] = getter;\n          return acc;\n        }, {}),\n      };\n    },\n  };\n}\n","import Vue from 'vue';\nimport Vuex, { StoreOptions } from 'vuex';\nimport { Store } from 'vuex';\nimport type { ModuleBuilder } from './types';\n\ntype Options<RootState> = StoreOptions<RootState> & {\n  /* eslint-disable-next-line @typescript-eslint/no-explicit-any */\n  moduleBuilders?: { [m in keyof RootState]?: ModuleBuilder<any, RootState> };\n};\n\n/**\n * create an instance of {@see Store} and build {@see ModuleBuilder} objects.\n *\n * ```ts\n * const module1 = createModule({ prop1: 1 });\n * const module2 = createModule({ prop2: 2 });\n *\n * const store = createStore({\n *   moduleBuilders: {\n *     module1,\n *     module2,\n *   }\n * })\n * ```\n *\n * @param options - A extended {@see StoreOptions} that includes moduleBuilders Record.\n */\nexport function createStore<RootState = never>(\n  options: Options<RootState>,\n): Store<RootState> {\n  Vue.use(Vuex);\n\n  const modules: [string, ModuleBuilder<RootState>][] = Object.entries(\n    options.moduleBuilders || {},\n  );\n\n  return new Store<RootState>({\n    ...options,\n    modules: {\n      ...(options?.modules || {}),\n      ...modules.reduce((acc, [name, builder]) => {\n        const _m = builder.getModule(name);\n        acc[_m.name] = _m;\n        return acc;\n      }, {}),\n    },\n  });\n}\n"],"names":["Vue","Vuex","Store"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAQA,IAAM,aAAa,GAAG,UACpB,UAAoC,EACpC,IAAY,IACT,OAAA,UAAC,OAAU,IAAK,QAAC;QACpB,IAAI,EAAE,UAAU,EAAE,GAAM,UAAU,EAAE,SAAI,IAAM,GAAG,IAAI;QACrD,OAAO,SAAA;KACR,IAAC,GAAA,CAAC;IAEH,SAAS,qBAAqB,CAC5B,MAAgD;QAEhD,OAAO,UACL,KAAsC,EACtC,EAA4C;gBAA1C,OAAO,aAAA;YAET,OAAA,MAAM,uBAEC,KAAK,KACR,MAAM,EAAE,UAAC,IAAI,IAAK,OAAA,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,GAAA,EACpD,QAAQ,EAAE,UAAC,IAAI,IAAK,OAAA,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,GAAA,KAE1D,OAAO,CACR;SAAA,CAAC;IACN,CAAC;IAED;;;;;;;;;;;;;;;aAegB,YAAY,CAC1B,YAAmB;QAEnB,IAAM,SAAS,GAA+B,EAAE,CAAC;QACjD,IAAM,OAAO,GAA+C,EAAE,CAAC;QAC/D,IAAM,OAAO,GAA+B,EAAE,CAAC;QAE/C,IAAI,UAAkB,CAAC;QACvB,IAAM,aAAa,GAAG,cAAM,OAAA,UAAU,GAAA,CAAC;QAEvC,OAAwC;YACtC,QAAQ,EAAR,UAAkB,IAAY,EAAE,EAA6B;gBAC3D,IAAI,CAAC,EAAE,EAAE;oBACP,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAG,IAAM,EAAE,UAAC,KAAK,EAAE,KAAK;wBAC3CA,uBAAG,CAAC,GAAG,CAAC,KAAY,EAAE,KAAG,IAAM,EAAE,KAAK,CAAC,CAAC;qBACzC,CAAC,CAAC;iBACJ;gBACD,EAAE,CAAC,QAAQ,GAAG,cAAM,OAAA,KAAG,IAAM,GAAA,CAAC;gBAC7B,SAAwC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBACnD,OAAO,aAAa,CAAU,aAAa,EAAE,IAAI,CAAC,CAAC;aACpD;YACD,MAAM,EAAN,UACE,IAAY,EACZ,EAA4C;gBAE5C,EAAE,CAAC,QAAQ,GAAG,cAAM,OAAA,KAAG,IAAM,GAAA,CAAC;gBAC7B,OAAsD,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBACjE,OAAO,aAAa,CAAU,aAAa,EAAE,IAAI,CAAC,CAAC;aACpD;YACD,MAAM,EAAN,UAAgB,IAAY,EAAE,EAA4B;gBACxD,EAAE,CAAC,QAAQ,GAAG,cAAM,OAAA,KAAG,IAAM,GAAA,CAAC;gBAC9B,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;gBACjB,OAAO,UAAC,MAAW;oBACjB,OAAA,MAAM,CAAI,UAAU,SAAI,IAAM,CAAC,IAAI,MAAM,CAAC,IAAI,CAAC;iBAAA,CAAC;aACnD;YACD,SAAS,YAAC,IAAS;gBAAT,qBAAA,EAAA,SAAS;gBACjB,UAAU,GAAG,IAAI,CAAC;gBAClB,OAAO;oBACL,IAAI,EAAE,UAAU;oBAChB,UAAU,EAAE,IAAI;oBAChB,KAAK,EAAE,YAAY;oBACnB,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,MAAM;wBAClC,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,qBAAqB,CAAC,MAAM,CAAC,CAAC;wBACvD,OAAO,GAAG,CAAC;qBACZ,EAAE,EAAE,CAAC;oBACN,SAAS,EAAE,SAAS,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,QAAQ;wBACxC,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,GAAG,UAAC,KAAK,EAAE,EAAW;gCAAT,OAAO,aAAA;4BAC1C,OAAA,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC;yBAAA,CAAC;wBAC3B,OAAO,GAAG,CAAC;qBACZ,EAAE,EAAE,CAAC;oBACN,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,MAAM;wBAClC,GAAG,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,GAAG,MAAM,CAAC;wBAChC,OAAO,GAAG,CAAC;qBACZ,EAAE,EAAE,CAAC;iBACP,CAAC;aACH;SACF,CAAC;IACJ;;IC/FA;;;;;;;;;;;;;;;;;aAiBgB,WAAW,CACzB,OAA2B;QAE3BA,uBAAG,CAAC,GAAG,CAACC,wBAAI,CAAC,CAAC;QAEd,IAAM,OAAO,GAAyC,MAAM,CAAC,OAAO,CAClE,OAAO,CAAC,cAAc,IAAI,EAAE,CAC7B,CAAC;QAEF,OAAO,IAAIC,UAAK,uBACX,OAAO,KACV,OAAO,yBACD,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,OAAO,KAAI,EAAE,IACvB,OAAO,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,EAAe;oBAAd,IAAI,QAAA,EAAE,OAAO,QAAA;gBACpC,IAAM,EAAE,GAAG,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;gBACnC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;gBAClB,OAAO,GAAG,CAAC;aACZ,EAAE,EAAE,CAAC,KAER,CAAC;IACL;;;;;;;;;;;"}